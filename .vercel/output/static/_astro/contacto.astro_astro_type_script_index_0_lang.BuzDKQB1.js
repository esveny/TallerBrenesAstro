const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/supabase.CzbVPcHp.js","_astro/preload-helper.BlTxHScW.js"])))=>i.map(i=>d[i]);
import{_ as p}from"./preload-helper.BlTxHScW.js";window.enableSubmitButton=function(){const t=document.getElementById("submit-button");t&&(t.disabled=!1)};window.disableSubmitButton=function(){const t=document.getElementById("submit-button");t&&(t.disabled=!0)};document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("contact-form"),i=document.getElementById("submit-button");i&&(i.disabled=!0),t?.addEventListener("submit",async f=>{f.preventDefault();const s=window.grecaptcha.getResponse();if(!s){window.showError("Por favor complete la verificación reCAPTCHA");return}try{if(!(await(await fetch("/api/verify-recaptcha",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:s})})).json()).success){window.showError("Verificación de seguridad fallida. Por favor intente nuevamente."),window.grecaptcha.reset();return}}catch(o){console.error("Error verificando reCAPTCHA:",o),window.showError("Error en la verificación de seguridad. Por favor intente nuevamente."),window.grecaptcha.reset();return}const a=new FormData(t),e={name:a.get("name"),email:a.get("email"),phone:a.get("phone"),message:a.get("message"),recaptcha:s};if(!e.name||!e.email||!e.phone||!e.message){window.showError("Por favor complete todos los campos requeridos");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)){window.showError("Por favor ingrese un email válido");return}if(!/^[\d\s\-\+\(\)]+$/.test(e.phone)){window.showError("Por favor ingrese un teléfono válido");return}try{const o=t.querySelector('button[type="submit"]'),r=o.textContent;o.disabled=!0,o.textContent="Enviando...";const{supabase:c}=await p(async()=>{const{supabase:n}=await import("./supabase.CzbVPcHp.js");return{supabase:n}},__vite__mapDeps([0,1]));if(!c)throw new Error("Supabase no está configurado correctamente");const{data:m,error:d}=await c.rpc("submit_contact_form",{p_nombre:e.name,p_email:e.email,p_telefono:e.phone,p_mensaje:e.message});if(d)throw new Error(d.message);if(!m.success)throw new Error(m.error);try{const n=await p(()=>import("./index.CSgyHkap.js"),[]),l="service_csx4c58",u="template_6cd377x",w="TE9SmkSUJlzUxlzbA";await n.send(l,u,{to_email:"infotallerbrenes@gmail.com",from_name:e.name,from_email:e.email,phone:e.phone,message:e.message,timestamp:new Date().toLocaleString("es-CR")},w),console.log("✅ Email enviado correctamente")}catch(n){console.warn("⚠️ Error enviando email (pero la consulta se guardó):",n)}window.showSuccess("¡Mensaje enviado correctamente! Nos pondremos en contacto pronto."),t.reset(),window.grecaptcha.reset(),o.disabled=!0,o.disabled=!1,o.textContent=r}catch(o){console.error("Error al enviar:",o),window.showError("Error al enviar el mensaje. Por favor intente nuevamente.");const r=t.querySelector('button[type="submit"]');r.disabled=!0,r.textContent="Enviar Mensaje",window.grecaptcha.reset()}})});
