class r{modal=null;modalContent=null;imageContainer=null;image=null;currentProduct=null;currentImageIndex=0;currentImages=[];zoomLevel=1;minZoom=.5;maxZoom=3;zoomStep=.25;isDragging=!1;dragStart={x:0,y:0};imageOffset={x:0,y:0};infoPanelOpen=!1;constructor(){this.init()}init(){this.modal=document.getElementById("enhanced-product-modal"),this.modalContent=this.modal?.querySelector(".bg-white"),this.imageContainer=document.getElementById("image-zoom-container"),this.image=document.getElementById("enhanced-modal-image"),this.setupEventListeners()}setupEventListeners(){document.getElementById("zoom-in-btn")?.addEventListener("click",()=>this.zoomIn()),document.getElementById("zoom-out-btn")?.addEventListener("click",()=>this.zoomOut()),document.getElementById("reset-zoom-btn")?.addEventListener("click",()=>this.resetZoom()),document.getElementById("prev-image-btn")?.addEventListener("click",()=>{console.log("Prev button clicked"),this.prevImage()}),document.getElementById("next-image-btn")?.addEventListener("click",()=>{console.log("Next button clicked"),this.nextImage()}),document.getElementById("toggle-info-btn")?.addEventListener("click",()=>this.toggleInfoPanel()),document.getElementById("share-project-btn")?.addEventListener("click",()=>this.shareProject()),this.imageContainer?.addEventListener("wheel",t=>this.handleWheel(t)),this.imageContainer?.addEventListener("mousedown",t=>this.startDrag(t)),document.addEventListener("mousemove",t=>this.drag(t)),document.addEventListener("mouseup",()=>this.endDrag()),this.setupTouchEvents(),document.addEventListener("keydown",t=>this.handleKeyboard(t))}setupTouchEvents(){if(!this.imageContainer)return;let t=0,n=1;this.imageContainer.addEventListener("touchstart",e=>{e.touches.length===2?(t=this.getTouchDistance(e.touches[0],e.touches[1]),n=this.zoomLevel):e.touches.length===1&&this.startDrag(e.touches[0])}),this.imageContainer.addEventListener("touchmove",e=>{if(e.preventDefault(),e.touches.length===2){const o=this.getTouchDistance(e.touches[0],e.touches[1])/t;this.setZoom(n*o)}else e.touches.length===1&&this.isDragging&&this.drag(e.touches[0])}),this.imageContainer.addEventListener("touchend",()=>{this.endDrag()})}getTouchDistance(t,n){const e=t.clientX-n.clientX,i=t.clientY-n.clientY;return Math.sqrt(e*e+i*i)}open(t){!this.modal||!this.modalContent||(this.currentProduct=t,this.currentImages=t.images||[t.image],this.currentImageIndex=0,this.updateModalContent(),this.showModal(),this.resetZoom(),this.updateNavigation(),this.createThumbnails())}updateModalContent(){if(!this.currentProduct)return;const t=document.getElementById("enhanced-modal-title"),n=document.getElementById("enhanced-modal-description"),e=document.getElementById("enhanced-modal-category"),i=document.getElementById("enhanced-modal-counter");if(t&&(t.textContent=this.currentProduct.name),n&&(n.textContent=this.currentProduct.description),e&&(e.textContent=this.currentProduct.category),i){const o=i.querySelector("span");o&&(o.textContent=`${this.currentImageIndex+1} / ${this.currentImages.length}`),i.style.display=this.currentImages.length>1?"block":"none"}this.updateImage()}updateImage(){if(!this.image)return;const t=this.currentImages[this.currentImageIndex];this.image.src=t,this.image.alt=this.currentProduct?.name||"Proyecto"}showModal(){!this.modal||!this.modalContent||(this.modal.classList.remove("hidden"),this.modal.classList.add("flex"),setTimeout(()=>{this.modalContent?.classList.remove("scale-95","opacity-0"),this.modalContent?.classList.add("scale-100","opacity-100")},10),document.body.style.overflow="hidden",this.toggleWhatsAppButton(!1))}close(t){!this.modal||!this.modalContent||t&&t.target!==this.modal||(this.modalContent.classList.remove("scale-100","opacity-100"),this.modalContent.classList.add("scale-95","opacity-0"),setTimeout(()=>{this.modal?.classList.add("hidden"),this.modal?.classList.remove("flex"),document.body.style.overflow="",this.toggleWhatsAppButton(!0)},300))}zoomIn(){this.setZoom(Math.min(this.zoomLevel+this.zoomStep,this.maxZoom))}zoomOut(){this.setZoom(Math.max(this.zoomLevel-this.zoomStep,this.minZoom))}resetZoom(){this.setZoom(1),this.imageOffset={x:0,y:0},this.updateImageTransform()}setZoom(t){this.zoomLevel=Math.max(this.minZoom,Math.min(this.maxZoom,t)),this.updateZoomDisplay(),this.updateImageTransform()}updateZoomDisplay(){const t=document.getElementById("zoom-level");t&&(t.textContent=`${Math.round(this.zoomLevel*100)}%`)}updateImageTransform(){this.image&&(this.image.style.transform=`translate(${this.imageOffset.x}px, ${this.imageOffset.y}px) scale(${this.zoomLevel})`)}handleWheel(t){t.preventDefault();const n=t.deltaY>0?-this.zoomStep:this.zoomStep;this.setZoom(this.zoomLevel+n)}startDrag(t){this.zoomLevel<=1||(this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.imageContainer&&(this.imageContainer.style.cursor="grabbing"))}drag(t){if(!this.isDragging||this.zoomLevel<=1)return;const n=t.clientX-this.dragStart.x,e=t.clientY-this.dragStart.y;this.imageOffset.x+=n,this.imageOffset.y+=e,this.dragStart={x:t.clientX,y:t.clientY},this.updateImageTransform()}endDrag(){this.isDragging=!1,this.imageContainer&&(this.imageContainer.style.cursor=(this.zoomLevel>1,"grab"))}prevImage(){console.log("prevImage called:",{currentIndex:this.currentImageIndex,canGoPrev:this.currentImageIndex>0}),this.currentImageIndex>0&&(this.currentImageIndex--,this.updateModalContent(),this.resetZoom(),this.updateNavigation())}nextImage(){console.log("nextImage called:",{currentIndex:this.currentImageIndex,totalImages:this.currentImages.length,canGoNext:this.currentImageIndex<this.currentImages.length-1}),this.currentImageIndex<this.currentImages.length-1&&(this.currentImageIndex++,this.updateModalContent(),this.resetZoom(),this.updateNavigation())}updateNavigation(){const t=document.getElementById("prev-image-btn"),n=document.getElementById("next-image-btn");if(console.log("updateNavigation:",{currentIndex:this.currentImageIndex,totalImages:this.currentImages.length,prevBtn:!!t,nextBtn:!!n}),t){const e=this.currentImageIndex>0;t.style.display=e?"flex":"none",t.style.visibility=e?"visible":"hidden"}if(n){const e=this.currentImageIndex<this.currentImages.length-1;n.style.display=e?"flex":"none",n.style.visibility=e?"visible":"hidden"}}createThumbnails(){const t=document.getElementById("thumbnails-scroll");!t||this.currentImages.length<=1||(t.innerHTML="",this.currentImages.forEach((n,e)=>{const i=document.createElement("button");i.className=`flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition-all duration-200 ${e===this.currentImageIndex?"border-primary-500 ring-2 ring-primary-200":"border-gray-300 hover:border-gray-400"}`;const o=document.createElement("img");o.src=n,o.className="w-full h-full object-cover",o.alt=`Vista ${e+1}`,i.appendChild(o),i.addEventListener("click",()=>{this.currentImageIndex=e,this.updateModalContent(),this.resetZoom(),this.createThumbnails()}),t.appendChild(i)}))}toggleInfoPanel(){const t=document.getElementById("info-content"),n=document.getElementById("toggle-icon");this.infoPanelOpen=!this.infoPanelOpen,t&&(t.style.display=this.infoPanelOpen?"block":"none"),n&&(n.style.transform=this.infoPanelOpen?"rotate(180deg)":"rotate(0deg)")}shareProject(){this.currentProduct&&(navigator.share?navigator.share({title:this.currentProduct.name,text:this.currentProduct.description,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),window.showSuccess&&window.showSuccess("Â¡Enlace copiado al portapapeles!")))}handleKeyboard(t){if(this.modal?.classList.contains("flex"))switch(t.key){case"Escape":this.close();break;case"ArrowLeft":this.prevImage();break;case"ArrowRight":this.nextImage();break;case"+":case"=":this.zoomIn();break;case"-":this.zoomOut();break;case"0":this.resetZoom();break}}toggleWhatsAppButton(t){const n=document.getElementById("whatsapp-button");if(!n)return;window.innerWidth<768&&(t?(n.style.display="flex",n.style.opacity="1"):(n.style.opacity="0",setTimeout(()=>{n.style.display="none"},300)))}}const a=new r;window.openEnhancedProductModal=function(s){a.open(s)};window.closeEnhancedModal=function(s){a.close(s)};
