---
interface Props {
  id?: string;
}

const { id = 'status-indicator' } = Astro.props;
---

<div class="business-status-container inline-flex items-center">
  <span 
    id={id}
    class="status-indicator px-3 py-1 text-sm font-bold rounded-full bg-yellow-500 text-white animate-pulse"
  >
    ‚è≥ Verificando...
  </span>
</div>

<script is:inline>
  function getCurrentBusinessStatus() {
    const businessHours = [
      { day: 0, openTime: 0, closeTime: 0, closed: true }, // Domingo
      { day: 1, openTime: 6, closeTime: 17, closed: false }, // Lunes
      { day: 2, openTime: 6, closeTime: 17, closed: false }, // Martes  
      { day: 3, openTime: 6, closeTime: 17, closed: false }, // Mi√©rcoles
      { day: 4, openTime: 6, closeTime: 17, closed: false }, // Jueves
      { day: 5, openTime: 6, closeTime: 17, closed: false }, // Viernes
      { day: 6, openTime: 6, closeTime: 12, closed: false }, // S√°bado
    ];

    const now = new Date();
    const currentDay = now.getDay();
    const currentHour = now.getHours();
    const currentMinute = now.getMinutes();
    const currentTime = currentHour + (currentMinute / 60);
    
    const todayHours = businessHours.find(h => h.day === currentDay);
    
    if (!todayHours || todayHours.closed) {
      return {
        isOpen: false,
        message: 'üî¥ Cerrado'
      };
    }
    
    const isCurrentlyOpen = currentTime >= todayHours.openTime && currentTime < todayHours.closeTime;
    
    if (isCurrentlyOpen) {
      return {
        isOpen: true,
        message: 'üü¢ Abierto ahora'
      };
    }
    
    return {
      isOpen: false,
      message: 'üî¥ Cerrado'
    };
  }
  
  function updateBusinessStatus() {
    const indicators = document.querySelectorAll('.status-indicator');
    if (!indicators.length) return;
    
    const status = getCurrentBusinessStatus();
    
    indicators.forEach(function(indicator) {
      indicator.textContent = status.message;
      indicator.className = 'status-indicator px-3 py-1 text-sm font-bold rounded-full ' + (
        status.isOpen 
          ? 'bg-green-500 text-white' 
          : 'bg-red-500 text-white'
      );
    });
  }
  
  // Ejecutar cuando el DOM est√© listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateBusinessStatus);
  } else {
    // DOM ya est√° listo, ejecutar inmediatamente
    updateBusinessStatus();
  }
  
  // Actualizar cada minuto
  setInterval(updateBusinessStatus, 60000);
</script>